/*
 * jQuery Form Plugin
 * version: 2.32 (17-SEP-2009)
 * @requires jQuery v1.2.2 or later
 *
 * Examples and documentation at: http://malsup.com/jquery/form/
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 */
(function(e){function t(){e.fn.ajaxSubmit.debug&&window.console&&window.console.log&&window.console.log("[jquery.form] "+Array.prototype.join.call(arguments,""))}e.fn.ajaxSubmit=function(n){function m(){function g(){if(h++)return;a.detachEvent?a.detachEvent("onload",g):a.removeEventListener("load",g,!1);var n=!0;try{if(p)throw"timeout";var r,s;s=a.contentWindow?a.contentWindow.document:a.contentDocument?a.contentDocument:a.document;var o=i.dataType=="xml"||s.XMLDocument||e.isXMLDoc(s);t("isXml="+o);if(!o&&(s.body==null||s.body.innerHTML=="")){if(--m){h=0,setTimeout(g,100);return}t("Could not access iframe DOM after 50 tries.");return}l.responseText=s.body?s.body.innerHTML:null,l.responseXML=s.XMLDocument?s.XMLDocument:s,l.getResponseHeader=function(e){var t={"content-type":i.dataType};return t[e]};if(i.dataType=="json"||i.dataType=="script"){var f=s.getElementsByTagName("textarea")[0];l.responseText=f?f.value:l.responseText}else i.dataType=="xml"&&!l.responseXML&&l.responseText!=null&&(l.responseXML=y(l.responseText));r=e.httpData(l,i.dataType)}catch(d){n=!1,e.handleError(i,l,"error",d)}n&&(i.success(r,"success"),c&&e.event.trigger("ajaxSuccess",[l,i])),c&&e.event.trigger("ajaxComplete",[l,i]),c&&!--e.active&&e.event.trigger("ajaxStop"),i.complete&&i.complete(l,n?"success":"error"),setTimeout(function(){u.remove(),l.responseXML=null},100)}function y(e,t){return window.ActiveXObject?(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)):t=(new DOMParser).parseFromString(e,"text/xml"),t&&t.documentElement&&t.documentElement.tagName!="parsererror"?t:null}var r=f[0];if(e(":input[name=submit]",r).length){alert('Error: Form elements must not be named "submit".');return}var i=e.extend({},e.ajaxSettings,n),s=e.extend(!0,{},e.extend(!0,{},e.ajaxSettings),i),o="jqFormIO"+(new Date).getTime(),u=e('<iframe id="'+o+'" name="'+o+'" src="about:blank" />'),a=u[0];u.css({position:"absolute",top:"-1000px",left:"-1000px"});var l={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(){this.aborted=1,u.attr("src","about:blank")}},c=i.global;c&&!(e.active++)&&e.event.trigger("ajaxStart"),c&&e.event.trigger("ajaxSend",[l,i]);if(s.beforeSend&&s.beforeSend(l,s)===!1){s.global&&e.active--;return}if(l.aborted)return;var h=0,p=0,d=r.clk;if(d){var v=d.name;v&&!d.disabled&&(n.extraData=n.extraData||{},n.extraData[v]=d.value,d.type=="image"&&(n.extraData[name+".x"]=r.clk_x,n.extraData[name+".y"]=r.clk_y))}setTimeout(function(){var t=f.attr("target"),s=f.attr("action");r.setAttribute("target",o),r.getAttribute("method")!="POST"&&r.setAttribute("method","POST"),r.getAttribute("action")!=i.url&&r.setAttribute("action",i.url),n.skipEncodingOverride||f.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),i.timeout&&setTimeout(function(){p=!0,g()},i.timeout);var l=[];try{if(n.extraData)for(var c in n.extraData)l.push(e('<input type="hidden" name="'+c+'" value="'+n.extraData[c]+'" />').appendTo(r)[0]);u.appendTo("body"),a.attachEvent?a.attachEvent("onload",g):a.addEventListener("load",g,!1),r.submit()}finally{r.setAttribute("action",s),t?r.setAttribute("target",t):f.removeAttr("target"),e(l).remove()}},10);var m=50}if(!this.length)return t("ajaxSubmit: skipping submit process - no element selected"),this;typeof n=="function"&&(n={success:n});var r=e.trim(this.attr("action"));r&&(r=(r.match(/^([^#]+)/)||[])[1]),r=r||window.location.href||"",n=e.extend({url:r,type:this.attr("method")||"GET"},n||{});var i={};this.trigger("form-pre-serialize",[this,n,i]);if(i.veto)return t("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(n.beforeSerialize&&n.beforeSerialize(this,n)===!1)return t("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var s=this.formToArray(n.semantic);if(n.data){n.extraData=n.data;for(var o in n.data)if(n.data[o]instanceof Array)for(var u in n.data[o])s.push({name:o,value:n.data[o][u]});else s.push({name:o,value:n.data[o]})}if(n.beforeSubmit&&n.beforeSubmit(s,this,n)===!1)return t("ajaxSubmit: submit aborted via beforeSubmit callback"),this;this.trigger("form-submit-validate",[s,this,n,i]);if(i.veto)return t("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var a=e.param(s);n.type.toUpperCase()=="GET"?(n.url+=(n.url.indexOf("?")>=0?"&":"?")+a,n.data=null):n.data=a;var f=this,l=[];n.resetForm&&l.push(function(){f.resetForm()}),n.clearForm&&l.push(function(){f.clearForm()});if(!n.dataType&&n.target){var c=n.success||function(){};l.push(function(t){e(n.target).html(t).each(c,arguments)})}else n.success&&l.push(n.success);n.success=function(e,t){for(var r=0,i=l.length;r<i;r++)l[r].apply(n,[e,t,f])};var h=e("input:file",this).fieldValue(),p=!1;for(var d=0;d<h.length;d++)h[d]&&(p=!0);var v=!1;return n.iframe||p||v?n.closeKeepAlive?e.get(n.closeKeepAlive,m):m():e.ajax(n),this.trigger("form-submit-notify",[this,n]),this},e.fn.ajaxForm=function(t){return this.ajaxFormUnbind().bind("submit.form-plugin",function(){return e(this).ajaxSubmit(t),!1}).each(function(){e(":submit,input:image",this).bind("click.form-plugin",function(t){var n=this.form;n.clk=this;if(this.type=="image")if(t.offsetX!=undefined)n.clk_x=t.offsetX,n.clk_y=t.offsetY;else if(typeof e.fn.offset=="function"){var r=e(this).offset();n.clk_x=t.pageX-r.left,n.clk_y=t.pageY-r.top}else n.clk_x=t.pageX-this.offsetLeft,n.clk_y=t.pageY-this.offsetTop;setTimeout(function(){n.clk=n.clk_x=n.clk_y=null},10)})})},e.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin"),this.each(function(){e(":submit,input:image",this).unbind("click.form-plugin")})},e.fn.formToArray=function(t){var n=[];if(this.length==0)return n;var r=this[0],i=t?r.getElementsByTagName("*"):r.elements;if(!i)return n;for(var s=0,o=i.length;s<o;s++){var u=i[s],a=u.name;if(!a)continue;if(t&&r.clk&&u.type=="image"){!u.disabled&&r.clk==u&&(n.push({name:a,value:e(u).val()}),n.push({name:a+".x",value:r.clk_x},{name:a+".y",value:r.clk_y}));continue}var f=e.fieldValue(u,!0);if(f&&f.constructor==Array)for(var l=0,c=f.length;l<c;l++)n.push({name:a,value:f[l]});else f!==null&&typeof f!="undefined"&&n.push({name:a,value:f})}if(!t&&r.clk){var h=e(r.clk),p=h[0],a=p.name;a&&!p.disabled&&p.type=="image"&&(n.push({name:a,value:h.val()}),n.push({name:a+".x",value:r.clk_x},{name:a+".y",value:r.clk_y}))}return n},e.fn.formSerialize=function(t){return e.param(this.formToArray(t))},e.fn.fieldSerialize=function(t){var n=[];return this.each(function(){var r=this.name;if(!r)return;var i=e.fieldValue(this,t);if(i&&i.constructor==Array)for(var s=0,o=i.length;s<o;s++)n.push({name:r,value:i[s]});else i!==null&&typeof i!="undefined"&&n.push({name:this.name,value:i})}),e.param(n)},e.fn.fieldValue=function(t){for(var n=[],r=0,i=this.length;r<i;r++){var s=this[r],o=e.fieldValue(s,t);if(o===null||typeof o=="undefined"||o.constructor==Array&&!o.length)continue;o.constructor==Array?e.merge(n,o):n.push(o)}return n},e.fieldValue=function(e,t){var n=e.name,r=e.type,i=e.tagName.toLowerCase();typeof t=="undefined"&&(t=!0);if(t&&(!n||e.disabled||r=="reset"||r=="button"||(r=="checkbox"||r=="radio")&&!e.checked||(r=="submit"||r=="image")&&e.form&&e.form.clk!=e||i=="select"&&e.selectedIndex==-1))return null;if(i=="select"){var s=e.selectedIndex;if(s<0)return null;var o=[],u=e.options,a=r=="select-one",f=a?s+1:u.length;for(var l=a?s:0;l<f;l++){var c=u[l];if(c.selected){var h=c.value;h||(h=c.attributes&&c.attributes.value&&!c.attributes.value.specified?c.text:c.value);if(a)return h;o.push(h)}}return o}return e.value},e.fn.clearForm=function(){return this.each(function(){e("input,select,textarea",this).clearFields()})},e.fn.clearFields=e.fn.clearInputs=function(){return this.each(function(){var e=this.type,t=this.tagName.toLowerCase();e=="text"||e=="password"||t=="textarea"?this.value="":e=="checkbox"||e=="radio"?this.checked=!1:t=="select"&&(this.selectedIndex=-1)})},e.fn.resetForm=function(){return this.each(function(){(typeof this.reset=="function"||typeof this.reset=="object"&&!this.reset.nodeType)&&this.reset()})},e.fn.enable=function(e){return e==undefined&&(e=!0),this.each(function(){this.disabled=!e})},e.fn.selected=function(t){return t==undefined&&(t=!0),this.each(function(){var n=this.type;if(n=="checkbox"||n=="radio")this.checked=t;else if(this.tagName.toLowerCase()=="option"){var r=e(this).parent("select");t&&r[0]&&r[0].type=="select-one"&&r.find("option").selected(!1),this.selected=t}})}})(jQuery);